
[공통 분석 가이드: 안전 및 출력]

부정 분석 – 안전 분석(safety_analysis)

★ 이 단계에서는 반드시 다음 5가지를 생성해야 한다:
1) environment_risks  
2) critical_events  
3) incident_events (전체 발생 이벤트 기록)  
4) incident_summary (등급별 횟수 + 실제 감점)  
5) safety_score (최종 안전 점수)

------------------------------------
(1) environment_risks
------------------------------------
- 각 위험 요소에 대해 다음 필드를 상세히 기록한다:
  - risk_type: 낙상 / 충돌 / 끼임 / 질식·삼킴 / 화상 / 기타
  - severity: 사고 / 위험 / 주의 / 권장
  - trigger_behavior: 어떤 행동이 위험을 유발했는지
  - environment_factor: 환경적 요인(모서리보호대 없음, 미끄러운 바닥 등)
  - has_safety_device: true/false (안전장치 유무)
  - safety_device_type: 모서리보호대 / 서랍잠금장치 / 문스토퍼 / 계단안전문 / 미끄럼방지매트 / 기타
  - comment: 이유 및 개선점
- **작성 시 주의사항**: 앞서 제시된 `[이 단계에서 특히 중요한 안전사고 위험 포인트]` 섹션의 내용을 우선적으로 참고하여, 해당 월령에 특화된 위험을 식별한다.
- 보호자의 동반 여부와 개입 방식을 관찰하여 `adult_presence`와 `overall_safety_level`을 평가한다.

------------------------------------
(2) critical_events
------------------------------------
- 실제 사고 또는 사고 직전 상황(심각도 '사고' 또는 '위험')을 기록한다.
- event_type: 실제사고 / 사고직전위험상황
- timestamp_range: **반드시 HH:MM:SS-HH:MM:SS 형식으로 기록** (예: "00:00:05-00:00:10"). 비디오 전체 길이는 메타데이터의 video_total_time을 참고하라.
- description: 상황 설명
- estimated_outcome: 큰부상가능 / 경미한부상가능 / 놀람·정서적스트레스 / 기타

------------------------------------
(3) incident_events  (전체 이벤트 기록)
------------------------------------
- 영상에서 관찰된 모든 '사고·위험·주의·권장' 이벤트를 1개씩 전부 기록한다.
- event_id: "E001" 등 순차 부여
- severity: 사고 / 위험 / 주의 / 권장
- timestamp_range: **반드시 HH:MM:SS-HH:MM:SS 형식으로 기록**
- description: 상세 설명
- has_safety_device: true/false

------------------------------------
(4) incident_summary  (등급별 횟수 + 감점 적용)
------------------------------------
각 severity 등급별로 다음을 기록한다:
- severity: 사고 / 위험 / 주의 / 권장
- occurrences: 해당 등급이 영상에서 총 몇 번 나타났는지
- applied_deduction: 실제 감점 값

------------------------------------
(5) 안전도 점수 계산 규칙 (safety_score)
------------------------------------

기본 점수 = 100점

감점 규칙:
- 사고: -50점 (최대 1회만 감점 적용)
- 위험: -30점 (최대 1회만 감점 적용)
- 주의: -10점 (최대 1회만 감점 적용)
- 권장: -2점 × 발생 건수 (최대 -16점)

계산 방식:
- incident_events → 모든 기록을 반영하여 각 등급별 occurrences 계산
- incident_summary → 감점 규칙에 따라 applied_deduction 생성
- safety_score = 100 + 모든 applied_deduction 합계
- 최종 점수는 50점보다 낮아지면 50점으로 처리한다.

디스클레이머
- `disclaimer` 필드에 아래 문장을 반드시 포함한다:
  "이 평가는 영상 기반 관찰에 따른 참고용 발달·안전 분석이며, 의학적 진단이나 전문 평가를 대체하지 않습니다."

[출력 형식]
- 반드시 아래 스키마를 따르는 **단일 JSON 객체만** 출력한다.
- JSON 외 텍스트(마크다운 코드블록 ```json 등)는 절대 포함하지 않는다.

```json
{
  "meta": {
    "observation_duration_minutes": 10,
    "assumed_stage": "5",
    "age_months": 15
  },
  "stage_consistency": {
    "match_level": "전형적",
    "evidence": ["혼자서 안정적으로 걷는 모습이 관찰됨"],
    "suggested_stage_for_next_analysis": null
  },
  "development_analysis": {
    "summary": "전반적으로 해당 월령에 맞는 발달을 보입니다.",
    "skills": [
      {
        "name": "독립 보행",
        "category": "대근육운동",
        "present": true,
        "frequency": 5,
        "level": "숙련",
        "examples": ["거실에서 주방으로 혼자 걸어감"]
      }
    ],
    "next_stage_signs": []
  },
  "safety_analysis": {
    "overall_safety_level": "주의",
    "adult_presence": "자주동반",
    "environment_risks": [
      {
        "risk_type": "낙상",
        "severity": "주의",
        "trigger_behavior": "걷다가 장난감 밟음",
        "environment_factor": "바닥에 장난감이 어지러져 있음",
        "has_safety_device": false,
        "safety_device_type": null,
        "comment": "장난감 정리가 필요함"
      }
    ],
    "critical_events": [],
    "incident_events": [
      {
        "event_id": "E001",
        "severity": "주의",
        "timestamp_range": "00:01:20-00:01:25",
        "description": "장난감을 밟고 비틀거림",
        "has_safety_device": false
      }
    ],
    "incident_summary": [
      {
        "severity": "주의",
        "occurrences": 1,
        "applied_deduction": -10
      }
    ],
    "safety_score": 90
  },
  "disclaimer": "이 평가는 영상 기반 관찰에 따른 참고용 발달·안전 분석이며, 의학적 진단이나 전문 평가를 대체하지 않습니다."
}
```
