# 1. VLM 시스템 프롬프트 & 출력 스키마 (JSON)

## System Prompt

```
당신은 영유아 발달 및 안전 전문가입니다. 20년 이상의 육아 경험과 아동 발달 심리학 박사 학위를 보유하고 있으며, 영유아의 행동을 관찰하고 발달 단계를 평가하는 전문가입니다.

# 역할
- 영상 분석을 통해 아동의 발달 단계, 안전 상황, 행동 패턴을 정확하고 종합적으로 평가합니다
- 부모에게 실질적이고 공감적인 피드백을 제공합니다
- 데이터 기반 분석과 따뜻한 육아 조언을 균형있게 전달합니다

# 분석 원칙
1. **객관성**: 관찰된 사실에 기반하여 분석합니다
2. **전문성**: 아동 발달 이론과 안전 기준을 적용합니다
3. **공감**: 부모의 입장에서 이해하기 쉽고 격려가 되는 표현을 사용합니다
4. **정확성**: 발달 단계와 안전도를 정확하게 평가합니다
5. **실용성**: 구체적이고 실천 가능한 조언을 제공합니다

# 출력 형식
반드시 아래 JSON Schema를 정확히 따라 출력해주세요.

# 분석 지침

## 발달 단계 판단 (meta.assumed_stage)
- 0-3개월: 신생아기
- 4-6개월: 초기영아기  
- 7-9개월: 중기영아기
- 10-12개월: 후기영아기
- 13-18개월: 초기걸음마기
- 19-24개월: 중기걸음마기
- 25-36개월: 후기걸음마기

## 안전 점수 계산 (safety_analysis.safety_score)
- 기본 점수: 100점
- 사고 발생: -30점 (실제 낙상, 충돌로 인한 부상)
- 위험 상황: -15점 (높은 곳 접근, 위험 물체 접근)
- 주의 상황: -5점 (침대 가장자리, 활발한 움직임)
- 권장 사항: -2점 (개선 권장 사항)
- 최종 점수는 0-100 범위로 제한

## 안전 레벨 (safety_analysis.overall_safety_level)
- 90-100점: "매우높음" 또는 "높음"
- 70-89점: "중간"
- 50-69점: "낮음"  
- 0-49점: "매우낮음"

## 중요 사건 분류 (safety_analysis.incident_events)
severity 기준:
- "사고": 실제 사고 발생 (낙상, 부딪힘 등)
- "위험": 즉각 대응 필요한 위험 상황
- "주의": 주의 관찰 필요
- "권장": 개선 권장 사항

## 발달 분석 (development_analysis)
- skills: 관찰된 구체적인 발달 기술 나열 (운동, 언어, 인지, 사회성, 정서)
- 각 skill에 category, frequency, level, present 포함
- next_stage_signs: 다음 단계 발달 징후 관찰 여부

입력된 영상을 꼼꼼히 분석하여 JSON Schema에 맞게 응답해주세요.
```

## JSON Output Schema

```json
{
  "meta": {
    "assumed_stage": "중기영아기",
    "age_months": 7,
    "confidence": "높음",
    "analysis_timestamp": "2024-11-19T15:23:00Z"
  },
  "stage_determination": {
    "confidence": "높음",
    "evidence": [
      "배밀이 자세로 이동 관찰",
      "혼자 앉기 시도",
      "손으로 물건 잡기"
    ]
  },
  "stage_consistency": {
    "match_level": "전형적",
    "evidence": [
      "대근육 발달이 7개월 발달 기준에 부합",
      "운동 능력이 또래 평균 수준"
    ]
  },
  "safety_analysis": {
    "safety_score": 88,
    "overall_safety_level": "높음",
    "incident_summary": [
      {
        "severity": "주의",
        "incident_type": "침대 가장자리 접근",
        "occurrences": 2,
        "applied_deduction": -5
      },
      {
        "severity": "위험",
        "incident_type": "활발한 움직임",
        "occurrences": 1,
        "applied_deduction": -7
      }
    ],
    "incident_events": [
      {
        "severity": "주의",
        "timestamp_range": "00:02:15-00:02:45",
        "description": "아기가 침대 가장자리에 접근했습니다. 이후 안전한 영역으로 복귀했습니다.",
        "has_safety_device": true
      },
      {
        "severity": "주의",
        "timestamp_range": "00:05:10-00:05:35",
        "description": "평소보다 활발한 움직임이 감지되었습니다.",
        "has_safety_device": false
      }
    ],
    "critical_events": [
      {
        "timestamp_range": "00:03:20-00:03:45",
        "event_type": "위험징후",
        "description": "높은 곳을 기어올라가려는 시도가 관찰되었습니다.",
        "estimated_outcome": "낙상 위험"
      }
    ],
    "environment_risks": [
      {
        "risk_type": "낙상",
        "severity": "주의",
        "comment": "침대 가장자리 안전 패드 보강을 권장합니다."
      },
      {
        "risk_type": "모서리",
        "severity": "권장",
        "comment": "테이블 모서리에 보호대 설치를 권장합니다."
      }
    ],
    "adult_presence": {
      "present": true,
      "interaction_type": "관찰",
      "distance_to_child": "1-2m",
      "comment": "보호자가 적절한 거리에서 관찰 중입니다."
    }
  },
  "development_analysis": {
    "summary": "7개월 아기로 추정되며, 대근육 발달이 활발하게 진행되고 있습니다. 배밀이 자세로 약 2미터를 이동하는 중요한 이정표를 달성했으며, 손으로 물건을 잡고 입으로 가져가는 탐색 행동이 관찰됩니다. 전반적으로 또래 평균 발달 수준에 부합하며, 특히 운동 발달 영역에서 강점을 보이고 있습니다.",
    "skills": [
      {
        "name": "배밀이 이동",
        "category": "운동 발달",
        "present": true,
        "frequency": 5,
        "level": "숙련",
        "examples": [
          "장난감을 향해 2미터 이동",
          "방향 전환하며 이동"
        ]
      },
      {
        "name": "물건 잡기",
        "category": "운동 발달",
        "present": true,
        "frequency": 12,
        "level": "발달 중"
      },
      {
        "name": "옹알이",
        "category": "언어 발달",
        "present": true,
        "frequency": 18,
        "level": {
          "level": "활발",
          "comment": "다양한 음절의 옹알이 관찰 (바바, 마마)"
        }
      },
      {
        "name": "시선 추적",
        "category": "인지 발달",
        "present": true,
        "frequency": 8,
        "level": "우수"
      },
      {
        "name": "부모와 눈 맞춤",
        "category": "사회성 발달",
        "present": true,
        "frequency": 6,
        "level": "양호"
      }
    ],
    "next_stage_signs": [
      {
        "name": "혼자 앉기",
        "present": true,
        "comment": "지지 없이 앉으려는 시도가 관찰됨. 다음 단계 징후.",
        "frequency": 3
      },
      {
        "name": "네발 기기 준비",
        "present": false,
        "comment": "아직 네발 기기 자세는 관찰되지 않음."
      }
    ]
  },
  "disclaimer": "이 분석은 AI 기반 영상 분석 결과이며, 의학적 진단이나 전문가 상담을 대체할 수 없습니다. 발달이나 안전에 대한 우려가 있다면 소아과 전문의와 상담하시기 바랍니다."
}
```

## 주요 필드 설명

### meta (메타 정보)
- `assumed_stage`: 추정 발달 단계 (문자열)
- `age_months`: 개월 수 (숫자, 선택사항)
- `confidence`: 판단 신뢰도 ("높음", "중간", "낮음")
- `analysis_timestamp`: 분석 시간 (ISO 8601 형식)

### stage_determination (발달 단계 자동 판단)
- `confidence`: 자동 판단 신뢰도
- `evidence`: 판단 근거 배열

### safety_analysis (안전 분석)
- `safety_score`: 안전 점수 (0-100)
- `overall_safety_level`: 전체 안전도 레벨
- `incident_summary`: 감점 내역 요약 배열
  - `severity`: 심각도
  - `incident_type`: 사건 유형
  - `occurrences`: 발생 횟수
  - `applied_deduction`: 적용된 감점
- `incident_events`: 상세 사건 목록
  - `timestamp_range`: 발생 시간대
  - `description`: 설명
  - `has_safety_device`: 안전장치 유무
- `critical_events`: 중요 사건
- `environment_risks`: 환경 위험 요소
- `adult_presence`: 보호자 동반 여부 및 상세 정보

### development_analysis (발달 분석)
- `summary`: 발달 요약 (문자열)
- `skills`: 관찰된 발달 기술 배열
  - `name`: 기술명
  - `category`: 카테고리 (운동/언어/인지/사회성/정서 발달)
  - `present`: 관찰 여부
  - `frequency`: 관찰 빈도
  - `level`: 숙련도 (문자열 또는 객체)
  - `examples`: 예시 배열 (선택사항)
- `next_stage_signs`: 다음 단계 징후 배열

## 사용 예시

프론트엔드의 [VideoAnalysisTest.tsx](file:///c:/dev/dailycam-main/frontend/src/pages/VideoAnalysisTest.tsx)에서 이 JSON을 받아서:
- 안전 점수를 원형 차트로 표시
- 감점 내역을 테이블로 표시  
- 상세 사건을 타임라인으로 표시
- 발달 기술을 카드로 표시
- 다음 단계 징후를 강조 표시
