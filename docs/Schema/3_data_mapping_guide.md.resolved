# 3. ë°ì´í„° ë§¤í•‘ ê°€ì´ë“œ

í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ê°€ ë°±ì—”ë“œ ì–´ëŠ í…Œì´ë¸”/ì»¬ëŸ¼ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ì§€ ìƒì„¸íˆ ë§¤í•‘í•©ë‹ˆë‹¤.

---

## 1. Settings.tsx - êµ¬ë… ì •ë³´

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface UserInfo {
  id: number
  email: string
  name: string
  picture: string
  created_at: string
  is_subscribed: boolean | number
  next_billing_at?: string | null
  subscription_plan?: string | null
  has_billing_key?: boolean
}
```

### ë°±ì—”ë“œ ë§¤í•‘

**ì‚¬ìš© í…Œì´ë¸”:** `users`

**API ì—”ë“œí¬ì¸íŠ¸:** `GET /api/auth/me`

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "id": 1,
  "email": "user@example.com",
  "name": "ê¹€ì§€ìˆ˜",
  "picture": "https://...",
  "created_at": "2024-11-01T10:00:00Z",
  "is_subscribed": 1,
  "subscription_plan": "BASIC",
  "subscription_customer_uid": "user_1",
  "next_billing_at": "2024-12-01T00:00:00Z",
  "has_billing_key": true
}
```

**ì»¬ëŸ¼ ë§¤í•‘:**
- `is_subscribed` â†’ `users.is_subscribed` (0 ë˜ëŠ” 1)
- `subscription_plan` â†’ `users.subscription_plan` ("BASIC", "PREMIUM" ë“±)
- `next_billing_at` â†’ `users.next_billing_at` (DateTime)
- `has_billing_key` â†’ `users.subscription_customer_uid IS NOT NULL`

**UI ë™ì‘ ë¡œì§:**
- `is_subscribed=1, has_billing_key=true`: "í™œì„±" ë°°ì§€, ìë™ê²°ì œ ì¤‘
- `is_subscribed=1, has_billing_key=false`: "ë§Œë£Œ ì˜ˆì •" ë°°ì§€, ìë™ê²°ì œ í•´ì§€ë¨
- `is_subscribed=0`: "ë¯¸ì‚¬ìš©" ë°°ì§€

---

## 2. SubscriptionPage.tsx - ê²°ì œ ì •ë³´

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface MeResponse {
  id: number
  email: string
  name: string
}
```

### ë°±ì—”ë“œ ë§¤í•‘

**ì‚¬ìš© í…Œì´ë¸”:** `users`

**API ì—”ë“œí¬ì¸íŠ¸:**
- `GET /api/auth/me` - ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
- `POST /api/payments/subscribe/basic/confirm` - ê²°ì œ ê²€ì¦ ë° êµ¬ë… í™œì„±í™”

**ê²°ì œ ê²€ì¦ ìš”ì²­ ë°”ë””:**
```json
{
  "imp_uid": "imp_123456789",
  "merchant_uid": "basic_1700123456789",
  "customer_uid": "user_1"
}
```

**ê²°ì œ ê²€ì¦ í›„ DB ì—…ë°ì´íŠ¸:**
```python
user.is_subscribed = 1
user.subscription_plan = "BASIC"
user.subscription_customer_uid = "user_1"
user.next_billing_at = datetime.now() + timedelta(days=30)
```

---

## 3. Dashboard.tsx - ëŒ€ì‹œë³´ë“œ í†µê³„

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface DashboardData {
  safetyScore: number           // ì˜¤ëŠ˜ ì•ˆì „ ì ìˆ˜
  monitoringHours: number       // ëª¨ë‹ˆí„°ë§ ì‹œê°„
  incidentCount: number         // ì´ë²¤íŠ¸ ê°ì§€ íšŸìˆ˜
  chartData: Array<{            // ì‹œê°„ëŒ€ë³„ ì°¨íŠ¸ ë°ì´í„°
    time: string
    safety: number
    development: number
  }>
  timelineEvents: Array<{       // íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸
    time: string
    hour: number
    type: 'development' | 'safety'
    title: string
    description: string
    hasClip: boolean
    category: string
  }>
}
```

### ë°±ì—”ë“œ ë§¤í•‘

**API ì—”ë“œí¬ì¸íŠ¸:** `GET /api/dashboard?days=7`

**ì‚¬ìš© í…Œì´ë¸”:**
- `daily_summaries` - ì¼ë³„ í†µê³„
- `safety_events` - íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸
- `highlight_clips` - í´ë¦½ ì—°ë™

**ì¿¼ë¦¬ ë¡œì§:**

```python
from datetime import date, timedelta
from sqlalchemy import func

# ì˜¤ëŠ˜ ì•ˆì „ ì ìˆ˜ (ì‹¤ì‹œê°„)
today = date.today()
daily_summary = db.query(DailySummary).filter(
    DailySummary.user_id == user_id,
    DailySummary.summary_date == today
).first()

safety_score = daily_summary.avg_safety_score if daily_summary else 95

# ëª¨ë‹ˆí„°ë§ ì‹œê°„
monitoring_hours = daily_summary.monitoring_hours if daily_summary else 0

# ì´ë²¤íŠ¸ ê°ì§€ íšŸìˆ˜
incident_count = db.query(func.count(SafetyEvent.id)).filter(
    SafetyEvent.user_id == user_id,
    func.date(SafetyEvent.event_timestamp) == today
).scalar()

# ì£¼ê°„ ì°¨íŠ¸ ë°ì´í„° (7ì¼)
chart_data = db.query(DailySummary).filter(
    DailySummary.user_id == user_id,
    DailySummary.summary_date >= today - timedelta(days=7),
    DailySummary.summary_date <= today
).order_by(DailySummary.summary_date).all()

# íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ (ì˜¤ëŠ˜)
timeline_events = db.query(SafetyEvent).filter(
    SafetyEvent.user_id == user_id,
    func.date(SafetyEvent.event_timestamp) == today
).order_by(SafetyEvent.event_timestamp.desc()).all()
```

**ì»¬ëŸ¼ ë§¤í•‘:**

| í”„ë¡ íŠ¸ì—”ë“œ | ë°±ì—”ë“œ í…Œì´ë¸”.ì»¬ëŸ¼ |
|-----------|------------------|
| `safetyScore` | `daily_summaries.avg_safety_score` |
| `monitoringHours` | `daily_summaries.monitoring_hours` |
| `incidentCount` | `safety_events` (COUNT) |
| `chartData[].time` | `daily_summaries.summary_date` |
| `chartData[].safety` | `daily_summaries.avg_safety_score` |
| `chartData[].development` | `daily_summaries.avg_development_score` |
| `timelineEvents[].time` | `safety_events.timestamp_range` |
| `timelineEvents[].type` | 'safety' (SafetyEvent í…Œì´ë¸”ì´ë¯€ë¡œ) |
| `timelineEvents[].title` | `safety_events.event_type` + ìë™ ìƒì„± |
| `timelineEvents[].description` | `safety_events.description` |
| `timelineEvents[].hasClip` | `safety_events.has_clip` |

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "safetyScore": 92,
  "monitoringHours": 16,
  "incidentCount": 4,
  "chartData": [
    {"time": "1ì¼ì°¨", "safety": 88, "development": 90},
    {"time": "2ì¼ì°¨", "safety": 90, "development": 92}
  ],
  "timelineEvents": [
    {
      "time": "15:00",
      "hour": 15,
      "type": "safety",
      "title": "ì¹¨ëŒ€ ê°€ì¥ìë¦¬ ì ‘ê·¼",
      "description": "ì•„ê¸°ê°€ ì¹¨ëŒ€ ê°€ì¥ìë¦¬ì— ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.",
      "hasClip": true,
      "category": "ì•ˆì „ ì£¼ì˜"
    }
  ]
}
```

---

## 4. SafetyReport.tsx - ì•ˆì „ ë¦¬í¬íŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface SafetyReportData {
  currentSafetyScore: number
  weeklySafetyData: Array<{date: string, ì•ˆì „ë„: number}>
  monthlySafetyData: Array<{date: string, ì•ˆì „ë„: number}>
  clockData: Array<{
    hour: number
    safetyLevel: 'safe' | 'warning' | 'danger'
    safetyScore: number
  }>
  incidentTypeData: Array<{
    name: string
    value: number
    count: number
  }>
}
```

### ë°±ì—”ë“œ ë§¤í•‘

**API ì—”ë“œí¬ì¸íŠ¸:** `GET /api/safety-report?period=week`

**ì‚¬ìš© í…Œì´ë¸”:**
- `daily_summaries` - ì£¼ê°„/ì›”ê°„ ì¶”ì´
- `safety_events` - 24ì‹œê°„ ì‹œê³„, ì‚¬ê±´ ìœ í˜• í†µê³„

**ì¿¼ë¦¬ ë¡œì§:**

```python
from datetime import date, timedelta

# ì£¼ê°„ ì•ˆì „ë„ ì¶”ì´ (ìµœê·¼ 7ì¼)
weekly_data = db.query(DailySummary).filter(
    DailySummary.user_id == user_id,
    DailySummary.summary_date >= date.today() - timedelta(days=7)
).order_by(DailySummary.summary_date).all()

# 24ì‹œê°„ ì‹œê³„ ë°ì´í„°
clock_data = db.query(
    SafetyEvent.event_hour,
    func.avg(SafetyEvent.severity).label('avg_severity')
).filter(
    SafetyEvent.user_id == user_id,
    func.date(SafetyEvent.event_timestamp) == date.today()
).group_by(SafetyEvent.event_hour).all()

# ì‚¬ê±´ ìœ í˜•ë³„ í†µê³„
incident_types = db.query(
    SafetyEvent.event_type,
    func.count(SafetyEvent.id).label('count')
).filter(
    SafetyEvent.user_id == user_id,
    func.date(SafetyEvent.event_timestamp) == date.today()
).group_by(SafetyEvent.event_type).all()
```

**ì»¬ëŸ¼ ë§¤í•‘:**

| í”„ë¡ íŠ¸ì—”ë“œ | ë°±ì—”ë“œ í…Œì´ë¸”.ì»¬ëŸ¼ |
|-----------|------------------|
| `currentSafetyScore` | `daily_summaries.avg_safety_score` (ì˜¤ëŠ˜) |
| `weeklySafetyData[].ì•ˆì „ë„` | `daily_summaries.avg_safety_score` |
| `clockData[].hour` | `safety_events.event_hour` |
| `clockData[].safetyLevel` | `safety_events.severity` ê¸°ë°˜ ê³„ì‚° |
| `incidentTypeData[].name` | `safety_events.event_type` |
| `incidentTypeData[].count` | `safety_events` COUNT |

---

## 5. DevelopmentReport.tsx - ë°œë‹¬ ë¦¬í¬íŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface DevelopmentReportData {
  radarData: Array<{
    category: 'ì–¸ì–´' | 'ìš´ë™' | 'ì¸ì§€' | 'ì‚¬íšŒì„±' | 'ì •ì„œ'
    score: number
    fullMark: 100
  }>
  dailyDevelopmentFrequency: Array<{
    category: string
    count: number
  }>
  recommendedActivities: Array<{
    title: string
    category: string
    description: string
  }>
}
```

### ë°±ì—”ë“œ ë§¤í•‘

**API ì—”ë“œí¬ì¸íŠ¸:** `GET /api/development-report?date=2024-11-19`

**ì‚¬ìš© í…Œì´ë¸”:**
- `daily_summaries` - ì¼ë³„ ë°œë‹¬ ë¹ˆë„
- `analysis_logs` - VLM ë¶„ì„ ê²°ê³¼ (JSON)

**ì¿¼ë¦¬ ë¡œì§:**

```python
# ì˜¤ëŠ˜ ë°œë‹¬ ì˜ì—­ë³„ ë¹ˆë„
today_summary = db.query(DailySummary).filter(
    DailySummary.user_id == user_id,
    DailySummary.summary_date == date.today()
).first()

daily_frequency = [
    {"category": "ì–¸ì–´", "count": today_summary.language_count},
    {"category": "ìš´ë™", "count": today_summary.motor_count},
    {"category": "ì¸ì§€", "count": today_summary.cognitive_count},
    {"category": "ì‚¬íšŒì„±", "count": today_summary.social_count},
    {"category": "ì •ì„œ", "count": today_summary.emotional_count}
]

# ìµœê·¼ ë¶„ì„ ë¡œê·¸ì—ì„œ ë°œë‹¬ ì ìˆ˜ ì¶”ì¶œ (5ê°í˜• ì°¨íŠ¸ìš©)
recent_logs = db.query(AnalysisLog).filter(
    AnalysisLog.user_id == user_id
).order_by(AnalysisLog.created_at.desc()).limit(10).all()

# JSONì—ì„œ skills ì¶”ì¶œí•˜ì—¬ ì¹´í…Œê³ ë¦¬ë³„ í‰ê·  ë ˆë²¨ ê³„ì‚°
radar_data = calculate_radar_from_logs(recent_logs)
```

**ì»¬ëŸ¼ ë§¤í•‘:**

| í”„ë¡ íŠ¸ì—”ë“œ | ë°±ì—”ë“œ í…Œì´ë¸”.ì»¬ëŸ¼ |
|-----------|------------------|
| `radarData[].category` | 'language', 'motor', 'cognitive', 'social', 'emotional' |
| `radarData[].score` | `analysis_logs.analysis_result['development_analysis']['skills']` ì§‘ê³„ |
| dailyDevelopmentFrequency[].count` | `daily_summaries.language_count` ë“± |

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "radarData": [
    {"category": "ì–¸ì–´", "score": 88, "fullMark": 100},
    {"category": "ìš´ë™", "score": 92, "fullMark": 100}
  ],
  "dailyDevelopmentFrequency": [
    {"category": "ì–¸ì–´", "count": 18},
    {"category": "ìš´ë™", "count": 25}
  ]
}
```

---

## 6. ClipHighlights.tsx - í´ë¦½ í•˜ì´ë¼ì´íŠ¸

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface ClipData {
  id: string
  title: string
  category: string
  timestamp: string
  duration: string
  thumbnail: string
  description: string
  importance: 'high' | 'medium' | 'warning' | 'info'
}

const developmentClips: ClipData[]
const safetyClips: ClipData[]
```

### ë°±ì—”ë“œ ë§¤í•‘

**API ì—”ë“œí¬ì¸íŠ¸:** `GET /api/clips?category=development&date=2024-11-19`

**ì‚¬ìš© í…Œì´ë¸”:** `highlight_clips`

**ì¿¼ë¦¬ ë¡œì§:**

```python
# ë°œë‹¬ í´ë¦½ ì¡°íšŒ
dev_clips = db.query(HighlightClip).filter(
    HighlightClip.user_id == user_id,
    HighlightClip.category == ClipCategory.DEVELOPMENT,
    func.date(HighlightClip.clip_timestamp) == target_date
).order_by(HighlightClip.clip_timestamp.desc()).all()

# ì•ˆì „ í´ë¦½ ì¡°íšŒ
safety_clips = db.query(HighlightClip).filter(
    HighlightClip.user_id == user_id,
    HighlightClip.category == ClipCategory.SAFETY,
    func.date(HighlightClip.clip_timestamp) == target_date
).order_by(HighlightClip.clip_timestamp.desc()).all()
```

**ì»¬ëŸ¼ ë§¤í•‘:**

| í”„ë¡ íŠ¸ì—”ë“œ | ë°±ì—”ë“œ í…Œì´ë¸”.ì»¬ëŸ¼ |
|-----------|------------------|
| [id](file:///c:/dev/dailycam-main/frontend/src/pages/Dashboard.tsx#22-37) | `highlight_clips.id` |
| `title` | `highlight_clips.title` |
| `category` | `highlight_clips.subcategory` |
| `timestamp` | `highlight_clips.clip_timestamp` |
| `duration` | `highlight_clips.duration_seconds` â†’ "0:45" ë³€í™˜ |
| `thumbnail` | `highlight_clips.thumbnail_emoji` ë˜ëŠ” `thumbnail_path` |
| `description` | `highlight_clips.description` |
| `importance` | `highlight_clips.importance` |

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "developmentClips": [
    {
      "id": "dev-1",
      "title": "ë°°ë°€ì´ ìì„¸ë¡œ 2ë¯¸í„° ì´ë™",
      "category": "ìš´ë™ ë°œë‹¬",
      "timestamp": "2024-11-19 15:23",
      "duration": "0:45",
      "thumbnail": "ğŸ¤¸",
      "description": "ì•„ê¸°ê°€ ë°°ë°€ì´ ìì„¸ë¡œ ì•½ 2ë¯¸í„°ë¥¼ ì´ë™í•˜ëŠ” ëª¨ìŠµì´ í¬ì°©ë˜ì—ˆìŠµë‹ˆë‹¤.",
      "importance": "high"
    }
  ],
  "safetyClips": [...]
}
```

---

## 7. VideoAnalysisTest.tsx - AI ë¶„ì„ ê²°ê³¼

### í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ìš”êµ¬ì‚¬í•­

```typescript
interface VideoAnalysisResult {
  meta: {...}
  safety_analysis: {...}
  development_analysis: {...}
  stage_determination: {...}
  disclaimer: string
}
```

### ë°±ì—”ë“œ ë§¤í•‘

**API ì—”ë“œí¬ì¸íŠ¸:** `POST /api/analysis/video`

**ìš”ì²­:**
```typescript
const formData = new FormData()
formData.append('video', videoFile)
formData.append('ageMonths', ageMonths)
formData.append('temperature', temperature)
formData.append('topK', topK)
formData.append('topP', topP)
```

**ì‘ë‹µ:** VLM JSON ê·¸ëŒ€ë¡œ ë°˜í™˜

**ì €ì¥ ë¡œì§:**
```python
# 1. VLM ë¶„ì„ ìˆ˜í–‰
vlm_result = await gemini_service.analyze_video(video, params)

# 2. AnalysisLogì— ì €ì¥
analysis_log = AnalysisLog(
    user_id=current_user.id,
    video_filename=video.filename,
    video_path=saved_path,
    analysis_result=vlm_result,  # JSON ì „ì²´ ì €ì¥
    assumed_stage=vlm_result['meta']['assumed_stage'],
    safety_score=vlm_result['safety_analysis']['safety_score'],
    ai_temperature=params.temperature
)
db.add(analysis_log)
db.commit()

# 3. SafetyEvent ë³„ë„ ì €ì¥
for incident in vlm_result['safety_analysis']['incident_events']:
    event = SafetyEvent(
        user_id=current_user.id,
        analysis_log_id=analysis_log.id,
        severity=incident['severity'],
        description=incident['description'],
        timestamp_range=incident['timestamp_range'],
        # ...
    )
    db.add(event)

# 4. HighlightClip ìƒì„± (ì¤‘ìš”ë„ ë†’ì€ ì´ë²¤íŠ¸ë§Œ)
if vlm_result['safety_analysis']['critical_events']:
    for critical in vlm_result['safety_analysis']['critical_events']:
        clip = HighlightClip(
            user_id=current_user.id,
            analysis_log_id=analysis_log.id,
            title=f"ì¤‘ìš” ì‚¬ê±´: {critical['event_type']}",
            category=ClipCategory.SAFETY,
            importance=ClipImportance.HIGH,
            # ...
        )
        db.add(clip)

db.commit()
```

**ì»¬ëŸ¼ ë§¤í•‘:**
- VLM ê²°ê³¼ ì „ì²´ â†’ `analysis_logs.analysis_result` (JSON)
- ê° í•„ë“œ â†’ `analysis_logs`ì˜ ê°œë³„ ì»¬ëŸ¼ (ì¸ë±ì‹±ìš©)
- ì´ë²¤íŠ¸ â†’ `safety_events` í…Œì´ë¸”ì— ë¶„ë¦¬ ì €ì¥
- í´ë¦½ â†’ `highlight_clips` í…Œì´ë¸”ì— ì €ì¥

---

## ìš”ì•½: API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

| í˜ì´ì§€ | API ì—”ë“œí¬ì¸íŠ¸ | ì‚¬ìš© í…Œì´ë¸” |
|-------|---------------|-----------|
| Settings | `GET /api/auth/me` | `users` |
| SubscriptionPage | `POST /api/payments/subscribe/basic/confirm` | `users` |
| Dashboard | `GET /api/dashboard?days=7` | `daily_summaries`, `safety_events` |
| SafetyReport | `GET /api/safety-report?period=week` | `daily_summaries`, `safety_events` |
| DevelopmentReport | `GET /api/development-report?date=2024-11-19` | `daily_summaries`, `analysis_logs` |
| ClipHighlights | `GET /api/clips?category=development` | `highlight_clips` |
| VideoAnalysisTest | `POST /api/analysis/video` | `analysis_logs`, `safety_events`, `highlight_clips` |

---

## ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
1. ë¹„ë””ì˜¤ ì—…ë¡œë“œ (VideoAnalysisTest)
   â†“
2. VLM ë¶„ì„ ìˆ˜í–‰
   â†“
3. AnalysisLog ì €ì¥ (JSON + ë©”íƒ€ë°ì´í„°)
   â”œâ”€ SafetyEvent ì €ì¥ (ê°œë³„ ì‚¬ê±´)
   â”œâ”€ HighlightClip ìƒì„± (ì¤‘ìš” ì‚¬ê±´)
   â””â”€ DailySummary ì§‘ê³„ (ë°°ì¹˜ ì‘ì—…)
   â†“
4. í”„ë¡ íŠ¸ì—”ë“œ ì¡°íšŒ
   â”œâ”€ Dashboard: DailySummary + SafetyEvent
   â”œâ”€ SafetyReport: DailySummary + SafetyEvent
   â”œâ”€ DevelopmentReport: DailySummary + AnalysisLog
   â””â”€ ClipHighlights: HighlightClip
```

---

## ì£¼ì˜ì‚¬í•­

### 1. JSON í•„ë“œ ì ‘ê·¼ (PostgreSQL)
```python
# PostgreSQL JSON ì¿¼ë¦¬
from sqlalchemy.dialects.postgresql import JSONB

db.query(AnalysisLog).filter(
    AnalysisLog.analysis_result['meta']['assumed_stage'].astext == 'ì¤‘ê¸°ì˜ì•„ê¸°'
).all()
```

### 2. MySQL JSON ì¿¼ë¦¬
```python
from sqlalchemy import func

db.query(AnalysisLog).filter(
    func.json_extract(AnalysisLog.analysis_result, '$.meta.assumed_stage') == 'ì¤‘ê¸°ì˜ì•„ê¸°'
).all()
```

### 3. íƒ€ì„ì¡´ ì²˜ë¦¬
```python
from datetime import datetime, timezone

# UTCë¡œ ì €ì¥
event.event_timestamp = datetime.now(timezone.utc)

# í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ì†¡ ì‹œ ISO 8601 í˜•ì‹
return event.event_timestamp.isoformat()
```

### 4. í˜ì´ì§€ë„¤ì´ì…˜
```python
# í´ë¦½ ëª©ë¡ ì¡°íšŒ ì‹œ
page = request.args.get('page', 1, type=int)
per_page = 20

clips = db.query(HighlightClip).filter(
    HighlightClip.user_id == user_id
).order_by(
    HighlightClip.clip_timestamp.desc()
).offset((page - 1) * per_page).limit(per_page).all()
```
