# 이슈 002: AI 생성 파라미터 최적화 (Generation Config Tuning)

## 이슈 요약
AI 모델의 분석 결과가 때로는 지나치게 창의적이어서 사실과 다른 내용을 생성(환각)하거나, 반대로 너무 기계적이고 딱딱한 어조로 출력되는 문제를 해결하기 위해 생성 파라미터를 튜닝함.

## 상태
해결됨

## 원인: 기본 설정(Default)의 불안정성
Gemini 모델의 기본 설정(Default)은 **Temperature가 0.9 ~ 1.0** 수준으로 높게 잡혀 있어, '창의적 글쓰기'나 '자유로운 대화'에 최적화되어 있습니다. 이를 분석 작업에 그대로 적용했을 때 다음과 같은 문제가 발생했습니다.

1.  **과도한 창의성 (Over-Creativity)**: 
    *   기본 설정은 모델이 다양한 표현을 시도하도록 유도합니다.
    *   이로 인해 영상에 없는 사물을 "봤다"고 하거나, 아이의 행동을 과장되게 해석하는 **환각(Hallucination)** 빈도가 높았습니다.
2.  **포맷 준수 실패**:
    *   JSON과 같은 엄격한 형식을 요구해도, 모델이 자유롭게 줄바꿈을 하거나 불필요한 서술을 덧붙여 파싱 에러가 자주 발생했습니다.
3.  **결과의 비일관성**:
    *   같은 영상을 두 번 분석시켰을 때, 첫 번째는 "안전함"이라 했다가 두 번째는 "위험함"이라 하는 등 결과가 들쭉날쭉했습니다.

## 해결 방법
분석의 '정확성'과 문장의 '자연스러움' 사이의 균형을 맞추기 위해 `GenerationConfig` 파라미터를 정밀하게 조정했습니다.

```python
generation_config = genai.types.GenerationConfig(
    temperature=0.4,  # 창의성 억제, 안정성 강화
    top_k=30,         # 확률 분포 꼬리 자르기
    top_p=0.95,       # 누적 확률 기반 필터링
)
```

### 1. Temperature (온도) : 0.4
- **의미**: 모델의 '창의성' 또는 '무작위성'을 제어하는 값 (0.0 ~ 1.0).
- **조정 이유**:
    - `1.0`에 가까우면 창의적이지만 거짓 정보를 생성할 위험이 큼.
    - `0.0`에 가까우면 사실적이지만 문장이 단조롭고 반복적임.
    - **0.4**로 설정하여 **사실에 기반한 분석(Fact-based)**을 최우선으로 하되, 부모가 읽기에 **자연스러운 문장**을 구사하도록 균형을 맞춤.

### 2. Top-k : 30
- **의미**: 다음 단어를 선택할 때, 확률이 높은 상위 K개의 후보군 중에서만 선택하도록 제한.
- **기본값(Default)**: 제한 없음 (모든 어휘가 후보에 포함됨)
- **조정 이유**:
    - 기본 설정에서는 확률이 극히 낮은 엉뚱한 단어도 선택될 수 있어, 문맥에 맞지 않는 표현이 튀어나올 위험이 있음.
    - 후보군을 **30개로 제한**하여 **안정적이고 문맥에 적합한 어휘**만 사용하도록 강제함.

### 3. Top-p (Nucleus Sampling) : 0.95
- **의미**: 상위 후보들의 누적 확률이 P(95%)가 될 때까지만 후보군에 포함.
- **기본값(Default)**: 1.0 또는 제한 없음 (모든 확률 분포 고려)
- **조정 이유**:
    - 기본 설정(1.0)에서는 확률이 낮은 단어들까지 모두 고려하여 예측 불가능한 출력이 발생할 수 있음.
    - **0.95로 설정**하여 상위 95% 확률 내의 단어만 사용하되, Top-k보다 유연하게 문맥에 따라 후보군 크기를 조절함.
    - 확신이 높은 상황에서는 후보를 좁히고, 애매한 상황에서는 후보를 넓혀 **문맥의 유연성**을 확보함.

## 결과
- **분석 신뢰도 향상**: 환각 현상이 현저히 줄어들고, 영상 데이터에 기반한 객관적인 분석 결과 도출.
- **출력 안정성**: JSON 포맷이 깨지거나 필수 필드가 누락되는 빈도가 감소함.
- **자연스러운 리포트**: 전문적이면서도 부모가 이해하기 쉬운 톤앤매너 확보.
